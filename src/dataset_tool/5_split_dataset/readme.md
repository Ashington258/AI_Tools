# YOLO 数据集划分工具

## 📋 功能简介

这是一个用于 YOLO 目标检测模型的数据集划分工具，可以将标注好的图像数据集按指定比例自动划分为训练集(train)、验证集(val)和测试集(test)，并生成标准的 YOLO 格式配置文件。

### 主要特性

- ✅ **图形化界面**：简单易用的 PyQt5 GUI 界面
- ✅ **自定义比例**：灵活设置训练/验证/测试集比例
- ✅ **自动匹配**：智能匹配图像和标签文件
- ✅ **标准结构**：生成符合 YOLO 标准的目录结构
- ✅ **YAML 生成**：自动生成 dataset.yaml 配置文件
- ✅ **多格式支持**：支持 .png、.jpg、.jpeg 等常见图像格式

---

## 🚀 快速开始

### 环境要求

```bash
Python >= 3.7
PyQt5
PyYAML
```

### 安装依赖

```bash
pip install PyQt5 PyYAML
```

### 运行程序

```bash
python split_dataset_UI.py
```

---

## 📖 使用教程

### 1. 准备数据

在使用本工具前，请确保您的数据已经按照以下格式准备好：

#### 目录结构示例

```
your_dataset/
├── images/              # 原始图像文件夹
│   ├── img001.jpg
│   ├── img002.jpg
│   └── ...
├── labels/              # YOLO 格式标签文件夹
│   ├── img001.txt
│   ├── img002.txt
│   └── ...
└── classes.txt          # 类别文件
```

#### 标签格式（YOLO 格式）

每个 `.txt` 标签文件对应一张图像，格式为：

```
<class_id> <x_center> <y_center> <width> <height>
```

- `class_id`：类别索引（从 0 开始）
- `x_center, y_center`：边界框中心点坐标（归一化到 0-1）
- `width, height`：边界框宽高（归一化到 0-1）

**示例：**
```
0 0.5 0.5 0.3 0.4
1 0.2 0.3 0.15 0.2
```

#### 类别文件格式

`classes.txt` 文件每行一个类别名称，顺序对应类别 ID：

```
person
car
dog
cat
```

---

### 2. 启动程序

运行 `split_dataset_UI.py` 后，会弹出图形界面。

---

### 3. 配置参数

#### 步骤 1：选择图片文件夹
点击 **"浏览"** 按钮，选择包含所有原始图像的文件夹。

#### 步骤 2：选择标签文件夹
点击 **"浏览"** 按钮，选择包含 YOLO 格式标签文件（.txt）的文件夹。

⚠️ **注意**：标签文件夹中只能包含 `.txt` 文件，不要放入其他类型的文件。

#### 步骤 3：选择保存文件夹
点击 **"浏览"** 按钮，选择划分后数据集的保存位置。

#### 步骤 4：选择类别文件
点击 **"浏览"** 按钮，选择包含类别名称的 `classes.txt` 文件。

#### 步骤 5：设置划分比例
- **训练集百分比**：默认 0.7（70%）
- **验证集百分比**：默认 0.15（15%）
- **测试集百分比**：默认 0.15（15%）

⚠️ **注意**：三个比例之和必须等于 1.0

---

### 4. 开始划分

点击 **"开始划分数据集并生成 YAML"** 按钮，程序将：

1. 创建标准 YOLO 目录结构
2. 随机划分数据集
3. 复制图像和标签到对应目录
4. 生成 `dataset.yaml` 配置文件

完成后会弹出提示框。

---

## 📁 输出结构

划分完成后，输出目录结构如下：

```
output_folder/
├── images/
│   ├── train/           # 训练集图像
│   │   ├── img001.jpg
│   │   ├── img005.jpg
│   │   └── ...
│   ├── val/             # 验证集图像
│   │   ├── img002.jpg
│   │   └── ...
│   └── test/            # 测试集图像
│       ├── img003.jpg
│       └── ...
├── labels/
│   ├── train/           # 训练集标签
│   │   ├── img001.txt
│   │   ├── img005.txt
│   │   └── ...
│   ├── val/             # 验证集标签
│   │   ├── img002.txt
│   │   └── ...
│   └── test/            # 测试集标签
│       ├── img003.txt
│       └── ...
└── dataset.yaml         # YOLO 配置文件
```

---

## 📄 dataset.yaml 文件

生成的 `dataset.yaml` 文件格式如下：

```yaml
path: E:\your_output_folder  # 数据集根目录（绝对路径）
train: images/train           # 训练集相对路径
val: images/val               # 验证集相对路径
test: images/test             # 测试集相对路径
names:                        # 类别映射
  0: person
  1: car
  2: dog
  3: cat
```

---

## 🔧 使用示例

### 示例 1：标准 70/15/15 划分

```
图片文件夹: E:\dataset\images
标签文件夹: E:\dataset\labels
保存文件夹: E:\yolo_dataset
类别文件: E:\dataset\classes.txt
训练集: 0.7
验证集: 0.15
测试集: 0.15
```

### 示例 2：80/10/10 划分

```
训练集: 0.8
验证集: 0.1
测试集: 0.1
```

### 示例 3：只划分训练集和验证集

```
训练集: 0.85
验证集: 0.15
测试集: 0.0
```

---

## ⚠️ 常见问题

### Q1: 提示"标签文件夹中没有有效的标签文件"
**A:** 请确保标签文件夹中包含 `.txt` 格式的文件，且文件名与图像文件名对应。

### Q2: 提示"未找到对应的图像文件"
**A:** 检查图像文件名和标签文件名是否一致（除扩展名外），例如：
- 图像：`img001.jpg`
- 标签：`img001.txt`

### Q3: 提示"训练、验证、测试集百分比之和必须等于1"
**A:** 确保三个比例相加等于 1.0，例如：0.7 + 0.15 + 0.15 = 1.0

### Q4: 路径中包含中文怎么办？
**A:** 程序已支持中文路径（UTF-8 编码），但为了兼容性，建议使用英文路径。

### Q5: 如何在 YOLO 训练中使用生成的数据集？
**A:** 在 YOLO 训练命令中指定 `dataset.yaml` 文件路径：

```bash
# YOLOv8 示例
yolo train data=E:\yolo_dataset\dataset.yaml model=yolov8n.pt epochs=100

# YOLOv5 示例
python train.py --data E:\yolo_dataset\dataset.yaml --weights yolov5s.pt --epochs=100
```

---

## 🛠️ 高级功能

### 命令行版本

如果需要批量处理或自动化脚本，可以使用 `split_dataset.py`（无 GUI 版本）：

```python
from split_dataset import split_dataset, generate_yaml

# 划分数据集
split_dataset(
    image_dir="E:/dataset/images",
    txt_dir="E:/dataset/labels",
    save_dir="E:/yolo_dataset",
    train_percent=0.7,
    val_percent=0.15,
    test_percent=0.15
)

# 生成 YAML
generate_yaml(
    txt_file="E:/dataset/classes.txt",
    save_dir="E:/yolo_dataset"
)
```

---

## 📝 注意事项

1. ⚠️ **标签文件夹纯净性**：标签文件夹中只能包含 `.txt` 文件，不要放入其他类型的文件
2. 💾 **数据备份**：划分前建议备份原始数据
3. 🌏 **路径格式**：支持中文路径，但建议使用英文路径以获得最佳兼容性
4. 🔗 **文件对应**：确保每个标签文件都有对应的图像文件
5. 🎲 **随机性**：每次运行会产生不同的划分结果（随机抽样）
6. 📊 **比例设置**：根据数据集大小合理设置比例，小数据集可增加训练集比例

---

## 📊 推荐划分比例

| 数据集大小 | 训练集 | 验证集 | 测试集 | 说明                        |
| ---------- | ------ | ------ | ------ | --------------------------- |
| < 1000     | 80%    | 10%    | 10%    | 小数据集，增加训练样本      |
| 1000-10000 | 70%    | 15%    | 15%    | 标准划分                    |
| > 10000    | 60%    | 20%    | 20%    | 大数据集，增加验证/测试样本 |

---

## 🎉 更新日志

### v1.0.0 (2026-02-05)
- ✨ 初始版本发布
- ✅ 支持图形化界面
- ✅ 自动生成 YAML 配置文件
- ✅ 支持多种图像格式
- ✅ 添加详细代码注释
- ✅ 完善使用文档


